<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
    <head>
        <title>Eckhardt Optics Kanban Board</title>
        <link type="text/css" href="jquery-ui-1.8.20.custom.css" rel="stylesheet" />
        <link type="text/css" href="demos.css" rel="stylesheet" />
        <link type="text/css" href="menu_black.css" rel="stylesheet" />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <script type="text/javascript" src="jquery-1.7.2.js"></script>
        <script type="text/javascript" src="jquery.ui.core.js"></script>
        <script type="text/javascript" src="jquery.ui.widget.js"></script>
        <script type="text/javascript" src="jquery.ui.mouse.js"></script>
        <script type="text/javascript" src="jquery.ui.sortable.js"></script>
        <script type="text/javascript" src="jquery.ui.button.js"></script>
        <script type="text/javascript" src="jquery.ui.draggable.js"></script>
        <script type="text/javascript" src="jquery.ui.position.js"></script>
        <script type="text/javascript" src="jquery.ui.resizable.js"></script>
        <script type="text/javascript" src="jquery.ui.dialog.js"></script>
        <script type="text/javascript" src="jquery.ui.datepicker.js"></script>
        <script type="text/javascript" src="jquery.ui.tabs.js"></script>
        <script type="text/javascript" src="mbMenu.js"></script>
        <script type="text/javascript" src="jquery.metadata.js"></script>
        <script type="text/javascript" src="jquery.hoverIntent.js"></script>
        <script type="text/javascript" src="jquery.json-2.3.js"></script>
        <script type="text/javascript" src="tiny_mce/tiny_mce.js"></script>
        <link type="text/css" href="index.css" rel="stylesheet" />


        <script type="text/javascript">
            $(document).ready(function() {
                
                //Enables the sortable behavior that allows the reordering of the cards
                $( ".column,.tablists" ).sortable({
                    connectWith: ".column,.tablists",
                    placeholder: "ui-state-highlight",
                    forcePlaceholderSize: true,
                    tolerance: 'pointer',
                    cursorAt: { top: 15 }
                }).disableSelection();
                
                //Initially diables the sorting of tabbed items
                $(".tablists").sortable("disable");
                
                //Prevents the banners from being selctable or sortable
                $(".column, .tablists").sortable({
                    cancel:".banners, .bigBanners",
                    items: "li:not(.banners, .bigBanners)"
                });
                
                
                //Method that opens, closes, and switches the tabs appropriately
                function handleTabLists(tablist){
                    
                    if ($(tablist).is(":visible"))
                        $(tablist).hide(1000).sortable( "disable" ); 
                    else
                    {
                        $(".tablists").each(function(){
                            if ($(this).is(":visible"))
                                $(this).hide().sortable( "disable" );
                        });
                        $(tablist).show().sortable( "enable" );
                    }
                }
                
                function closeContextMenu(){
                    $.fn.removeMbMenu($.mbMenu.options.actualMenuOpener);
                }
                
                //Handles the tab buttons dynamically
                $(".toolbar .btnTab").click(function(){
                    var tab =  $(this).html();
                   
                    handleTabLists("#"+tab);
                });
                
                /*$("#btnArchive").click(function(){
                    handleTabLists("#Archive");
                });*/
               
                $("#btnAddCard").click(function(){
                    addCard();
                });                              
                                
                    
                                        
                $(".card").live( "dblclick", function () { 
                    $( "#edit-tabs" ).tabs("select", 0);
                    editCard($(this).attr("id"));
                });
                  
                
                
                $( "#dialogInvalid" ).dialog({
                    autoOpen: false,
                    show: "blind",
                    hide: "explode",
                    show: "blind",
                    hide: "explode",
                    
                    modal: true,
                    buttons: {
                        Cancel: function() {
                            $( this ).dialog( "close" );
                        }
                    }
                });
                
               
                
                //Creates the edit dialog box
                $( "#dialogAddEditCard" ).dialog({
                    autoOpen: false,
                    minHeight: 560,
                    minWidth: 1060,
                    height: 560,
                    width: 1060,
                    show: { effect: 'blind', complete: function() { $("#title").focus();}},
                    hide: "explode",
                    modal: true,
                    buttons: {
                        "Save Card": function() {
                            
                            //Will need to add data editing code here later
                            $( this ).dialog( "close" );
                                                                                
                        },
                        Cancel: function() {
                            $( this ).dialog( "close" );
                        }    
                    },
                    
                    //Resets all the feilds to null to allow a fresh dialog window each time
                    close: function() {
                        $("#Details input, #Details textarea, #Details select").val("");
                    }
                    
                });
                
                //Allows calendar plugin
                $( ".Dates" ).datepicker();                                  
                
                //Allows the tabs on the edit dialog
                $( "#edit-tabs" ).tabs();
     
                
                $(document).buildContextualMenu(
                {
                    menuWidth:200,
                    overflow:2,
                    menuSelector: ".menuContainer",
                    iconPath:"ico/",
                    hasImages:false,                    
                    closeOnMouseOut: true,
                    fadeInTime:200,

                    fadeOutTime:100,

                    adjustLeft:0,
                    adjustTop:0,
                    opacity:.99,
                    shadow:true,
                    onContextualMenu:function(o,e){}

                });
                
                //Handles the moveallCards submenu 
                $("#moveAllCards a").click( function(){
                    //Finds and saves the column that was right clicked
                    var startCol = $($.mbMenu.lastContextMenuEl).attr("id");                
                    var endCol = $(this).html();
                    
                    //Cycles through each card in the specified column and moves them into the ending column
                    $("#"+startCol+" .card").each(function(){
                        
                        var newLi = $('<li></li>').append(this);
                        $("#"+endCol).append(newLi); 
                        var cardId = $(this).attr("id");
                        updatePosition(endCol, cardId);
                        
                    });
                    
                    //Previously the moveall method moved the cards but left all of the <li>s behind. This removes those(except the first: The banner)
                    $("#"+startCol+" li:not(:first-child)").remove();
                    
                    closeContextMenu(); 
                });
                
                //Handles the moveCardTo submenu moveCardTo
                $("#moveCardTo a").click(  function(){
                    var card = $($.mbMenu.lastContextMenuEl).parent();
                    var newLi = $('<li></li>').append(card);
                    var column = $(this).html();
                    $("#"+column).append(newLi);
                    var cardId = $($.mbMenu.lastContextMenuEl).attr("id");
                    
                    updatePosition(column, cardId);
                                       
                    closeContextMenu(); 
                });
                
                //Sets the priority of the card 
                $("#setPriority a").click( function(){
                    //Grabs the anchor's text
                    var prio = $(this).html();
                    //Finds which card was right clicked
                    var card = $.mbMenu.lastContextMenuEl;
                    //Stores the selected priority as the cards priority
                    $(card).data({"priority": prio});
                    displayHandler($(card));
                    closeContextMenu(); 
                })
                
                //Handles the edit dialog background color change based off of user selection
                $("#jobtype").change(function () {
                    var job = $(this).val();
                    $("#jobtype option").each(function(){
                        $("#Details").removeClass($(this).val());
                    });
                    $("#Details").addClass(job);
                });
                
                //Populates the components field based off of the selected product
                $("#product").change(function () {
                
                    var name = $(this).val();
                    getCompsVers(name);
                });
                
                //Updates the cards position whenever it is moved
                $( ".column, .tablists" ).sortable({
                    receive: function(event, ui) { 
                        
                        var col = $(this).attr("id");
                        updatePosition1(col);
                    }
                });
                
                
                
                //Initializes the TinyMCE Richtext editior
                tinyMCE.init({
                    // General options
                    mode : "exact",
                    elements: "comments, description",
                    theme : "advanced",
                    plugins : "pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template",

                    // Theme options
                    theme_advanced_buttons1 : "save,newdocument,|,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect,fontselect,fontsizeselect",
                    theme_advanced_buttons2 : "cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,image,cleanup,help,code,|,insertdate,inserttime,preview,|,forecolor,backcolor",
                    theme_advanced_toolbar_location : "top",
                    theme_advanced_toolbar_align : "left",
                    theme_advanced_statusbar: "bottom",
                    theme_advanced_resizing : true,

                    // Example content CSS (should be your site CSS)
                    content_css : "index.css",

                    // Drop lists for link/image/media/template dialogs
                    template_external_list_url : "js/template_list.js",
                    external_link_list_url : "js/link_list.js",
                    external_image_list_url : "js/image_list.js",
                    media_external_list_url : "js/media_list.js"

                    
                });
                
                
                //setup the dialog with the proper field values for the jobtype dropdown
                //Evan, go ahead and do the same for other dropdowns.  You might be able to find a way to get
                //MULTIPLE fields in one ajax call;  make an array out of the names field.
                //then parse the results --> handle each field's values
                //Hint: you'll have to wrap a foreach(to handle fields) around the foreach(to handle field's values) that I wrote.
                //And then also find some way to associate their field's name with this page's select dropdowns. (id or name maybe?)
                //also, note, I put this in the document.ready so that I'd be sure that the dialog code exists before I try to modify it.
                //The Array of fields that we want to find values for
                var formFields = ["priority","bug_severity", "bug_status"];
            
                //A single Ajax call that finds all the specified field option values                
                $.ajax({
                    url: "ajax_get_field_values.php",
                    type: "POST",
                    data: {"name": formFields},    
                    dataType: "json",
                    
                    success: function(data, status){
                        
                      
                        if (data.error)
                        {
                            
                            alert(data.error.message+ " Data.error is false");
                        }
                        else if (!data.result)
                        {
                            alert("Something is wrong");
                        }
                        else 
                        {
                            for (var j in data.result.fields)
                            {
                                var fieldName = data.result.fields[j].name;
                                if (fieldName == "bug_severity")
                                {
                                    //The way our Bugzilla is set up is that Severity=>Job Type
                                    fieldName="jobtype";
                                }
                               
                                //remove all <option>s from the specified select
                                $("#Details select[name="+fieldName+"]").empty();
                                
                                if (fieldName == "priority")
                                {
                                    //Populates the priority context menu as well
                                    for (var i in data.result.fields[j].values) 
                                    {    
                                        //get the value
                                        var name = data.result.fields[j].values[i].name;
                                   
                                        //create an option element with a value and the inner html being the name
                                        var a = $("<a>").html(name);

                                        //append the option to the <select>
                                        $("#setPriority").append(a);
                                    }  
                                }
                                //iterate through all the allowed values for this field
                                for (var i in data.result.fields[j].values) 
                                {    
                                    //get the value
                                    var name = data.result.fields[j].values[i].name;
                                   
                                    //create an option element with a value and the inner html being the name
                                    var option = $("<option>").val(name).html(name);

                                    //append the option to the <select>
                                    $("#Details select[name="+fieldName+"]").append(option);
                                }
                            }
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown){
                        alert("(Fields)There was an error:" + textStatus);
                    }
                }); 

                
                
                //An Ajax call that finds all accessible product ids. 
                //TODO: Very slow, consider revision
                $.ajax({
                    url: "ajax_get_product_list.php",
                    type: "POST",  
                    data:{},
                    dataType: "json",
                    success: function(data){
                        
                        if (data.error)
                        {
                            
                            alert(data.error.message+ " Data.error is false");
                        }
                        else if (!data.result)
                        {
                            alert("Something is wrong");
                        }
                        
                        var productIds = data.result.ids;
                        getNames(productIds);
                        
                    },
                    error: function(jqXHR, textStatus, errorThrown){
                        alert("There was an error:" + textStatus);
                    }
                });
                
                //A function that finds the name associated with each each id that is passed in. Very slow, consider revision
                function getNames(productIds){
                    $.ajax({
                        url: "ajax_get_product_props.php",
                        type: "POST",  
                        data:{"ids": productIds},
                        dataType: "json",
                        success: function(data){
                        
                            if (data.error)
                            {
                            
                                alert(data.error.message+ " Data.error is false");
                            }
                            else if (!data.result)
                            {
                                alert("Something is wrong");
                            }
                            else
                            {
                                for (var i in data.result.products)
                                {
                                    var name = data.result.products[i].name;
                                
                                    //create an option element with a value and the inner html being the name
                                    var option = $("<option>").val(name).html(name);

                                    //append the option to the <select>
                                    $("#Details select[name=product]").append(option);
                                } 
                                //Automatically populates the components and version fields based off of the first(default) product
                                var firstProduct = $("#Details select[name=product] option").first().html(); 
                                getCompsVers(firstProduct);
                            }
                                
                        
                        },
                        error: function(jqXHR, textStatus, errorThrown){
                            alert("There was an error:" + textStatus);
                        }
                    });
                    
                };
                
                $("body ul").each(function(){
                    var col = $(this).attr("id");
                    
                    var option = $("<a>").html(col);

                    //append the option to the <select>
                    $("#moveAllCards, #moveCardTo").append(option);
                });
           
                var bugArray = [772,1294,9003,9215,13213,5202];
                //Adds existing cards to the page  
                $.ajax({
                    url: "ajax_get_single_bug.php",
                    type: "POST",
                    data: { 
                        "bug_id": bugArray
                    },
                    dataType: "json",
                    success: function(data, status){
                        
                        if (data.error)
                        {
                            
                            alert(data.error.message+ " Data.error is false");
                        }
                        else if (!data.result)
                        {
                            alert("Something is wrong");
                        }
                        else
                        {
                            //alert(data.result.bugs[0].summary);
                            for (var i in data.result.bugs)
                            {
                                var bug = data.result.bugs[i];
                                createCard(bug.id,"Done", bug.component, bug.priority, bug.product, bug.severity, bug.summary, bug.version, bug.creator, bug.deadline, 10, "Test", bug.status);
                            }
                        }
                    }
                });
                
                
                /*$.ajax({
                    url: "ajax_modify_bug.php",
                    type: "POST",
                    data: { 
                        "bug_id": 1294,
                       
                        "priority": "P3"
                        
                    },
                    dataType: "json",
                    success: function(data, status){
                
                        if (data.error)
                        {
                            alert(data.error.message);
                        }
                        else if (!data.result)
                        {
                            alert("Something is wrong");
                        }
                        else 
                        {
                            //Will eventually hold the card.data map below. Need to make the Bug.Update work first
                        }
                        
                    },
                    error: function(jqXHR, textStatus, errorThrown){
                        alert("There was an error:" + textStatus);
                    }
                }); */
                
                
            });
              
              
              
            /*--------------------End Document.Ready------------------------*/
            
        
            var componentData = null;
        
            //Retrieves all of the available components and versions for a given product. Very slow, consider revision
            function getCompsVers(name){
                if (componentData == null)
                {
                    $.ajax({
                        //Need this to be completed before other actions occur:
                        //async: false,
                        url: "ajax_get_field_values.php",
                        type: "POST",
                        data: {
                            //"ids": id,
                            "name": ["component", "version"],
                            "value_field": "product"
                            /*"visibility_field": "Sam's Widget",
                            "values": {"visibility_values": ["Sam's Widget"]}*/
                        },    
                        dataType: "json",
                    
                        success: function(data, status){
                        
                      
                            if (data.error)
                            {
                            
                                alert(data.error.message+ " Data.error is false");
                            }
                            else if (!data.result)
                            {
                                alert("Something is wrong");
                            }
                            else 
                            {   
                                componentData =  data.result.fields;
                            
                            }
                        },
                        error: function(jqXHR, textStatus, errorThrown){
                            alert("(Fields)There was an error:" + textStatus);
                        }
                    });
                }
                for (var j in componentData)
                { 
                    var fieldName = componentData[j].name;
                                
                    //remove all <option>s from the specified select
                    $("#Details select[name="+fieldName+"]").empty();
                                
                    //iterate through all the allowed values for this field
                    for (var i in componentData[j].values) 
                    {   
                        //get the value
                        var visval =  componentData[j].values[i].visibility_values[0];
                                        
                        //This is a crude method of weeding out which values should be displayed based off of the product name
                        if (visval == name)
                        {    
                            //create an option element with a value and the inner html being the name                                     
                            var comp = componentData[j].values[i].name;
                            var option = $("<option>").val(comp).html(comp);

                            //append the option to the <select>
                            $("#Details select[name="+fieldName+"]").append(option);
                        }                                    
                                    
                                    
                    }
                }
            };
            
            function editCard(cardId) {
                var card = $('#'+cardId);
                getCompsVers(card.data("product"));
                //Changes the edit dialog to have the correct fields for the selected card's Product. 
                // TODO: The component and version retrieval is too slow and it changes after the dialog is opened and therefore removes the proper component and version selection
                //Bugzilla solves this by allowing the product to change without component update and then upon save a new page is opened confirming the change and prompting new version and component values
                
                // TODO: Create and new dialog if the the product name is changed  
                //Populates the fields
                $("#title").val(card.data("title"));
                $("#jobtype").val(card.data("jobtype"));
                $("#user").val(card.data("user"));
                $("#priority").val(card.data("priority"));
                //$("#whichColumn").val(card.data("whichColumn"));
                $("#dueDate").val(card.data("dueDate"));
                $("#size").val(card.data("size"));
                $("#description").val(card.data("description"));
                $("#product").val(card.data("product"));  
                $("#version").val(card.data("version"));
                $("#component").val(card.data("component"));
                $("#bug_status").val(card.data("status"));
              
                
                //Adds edit specifc dialog properties
                $("#dialogAddEditCard").dialog( "option", "title", "Edit Card" );
                $("#edit-tabs ul li").show();
                $("label[for=whichColumn],#whichColumn").hide();
                dialogDisplay(card.data("jobtype"));
                
                $( "#dialogAddEditCard" ).dialog( "option", "buttons", { 
                    "Save Card": function() {
                        
                        $('#'+cardId+" .cardText").html($("#title").val());
                        displayHandler(card); 
                        
                        //Finds the current column of the selected card
                        var col = card.parent().parent().attr("id");
                        
                        //TODO: Will need to send this info to the PHP file with modify function                    //Severity            //Summary
                        ajaxEditBug(col, $("#component").val(), cardId, $("#priority").val(), $("#product").val(), $("#jobtype").val(), $("#title").val(), $("#version").val(),$("#user").val(),$("#dueDate").val(), $("#size").val(), $("#description").val()); 
                         
                        $( this ).dialog( "close" );    
                    },
                    Cancel: function() {
                        $( this ).dialog( "close" );
                    }   
                });
                
                $( "#dialogAddEditCard" ).dialog( "open" );
                
            }
            
            function addCard() {
                //Adds add card specifc dialog properties
                $("#edit-tabs ul li:not(:first-child)").hide();
                $( "#edit-tabs" ).tabs("select", 0);
                $("label[for=whichColumn],#whichColumn").show();
                $("#dialogAddEditCard").dialog( "option", "title", "Add Card" );
                dialogDisplay(null);
                    
                $( "#dialogAddEditCard" ).dialog( "option", "buttons", { "Save Card": function() {
                        if($( "#title" ).val()=="")
                        {
                            $("#dialogInvalid").dialog("open");
                        }
                        else{                        
                            //Calls my card creation method, physically adds the card to the page with proper name and location(for now).
                            // createCard($("#whichColumn").val(), $("#title").val()); 
                            displayHandler($("#"+$("#title").val().replace(/\s+/g, '')));   
                            $( this ).dialog( "close" ); 
                        } 
                    },
                    Cancel: function() {
                        $( this ).dialog( "close" );
                    }   
                });
                    
                $( "#dialogAddEditCard" ).dialog( "open" );
                
            }                    
            
            function deleteCard(){
                //Handles the removal of the card from the page(and eventually from the database)
                $($.mbMenu.lastContextMenuEl).parent().remove();
                
                //Insert bugzilla interfacing here
                
            }
            
            function editCardContextMenu() {
                
                editCard($($.mbMenu.lastContextMenuEl).attr("id"));
            }           
            
            function addCardToCol() {
                //Finds and saves the column that was right clicked
                var startCol = $($.mbMenu.lastContextMenuEl).attr("id"); 
                
                //Presets the form to open with the correct column selected                
                $("#whichColumn").val(startCol);
                addCard();
            }
            
            function editView(index){
                $( "#edit-tabs" ).tabs("select", index);
                editCardContextMenu();
            }
            
            /*<editor-fold>*/
            function displayHandler(card) {
                //Finds the card's values    
                var cardRef = "#"+card.attr("id");
                var job = card.data("jobtype");
                var prio = card.data("priority");
                var dueDate = card.data("dueDate");
                var date = new Date(dueDate);
                var size =  card.data("size")

                
                // TODO: The below works as a simplified if else statement toggling between all the classes, need to adapt to the new names
                /*if (job != null)
                {
                    $("#jobtype option").each(function(){
                    
                        $(cardRef).removeClass($(this).val());
                    })
                    $(cardRef).addClass(job).attr({"title": job});
                    
                    $("#jobtype option").each(function(){
                        $("#Details").removeClass($(this).val());
                    });
                    $("#Details").addClass(job);
                }
                if (job == null)
                {
                    $("#jobtype option").each(function(){
                        $("#Details").removeClass($(this).val());
                    });
                    $("#Details").addClass("Task");
                    $(cardRef).addclass("Task");
                    
                }*/
        
                //$(cardRef).addclass("Task");
                
                //This section adds and switches the priority icon. TODO need to find new method taking the P# classification used by bugzilla
                if (prio != "Normal" && $(cardRef + " .prioBack").length == 0)
                {
                    $(cardRef+ " .iconBar").append("<div class=\"prioBack\"><div class=\"prioIcon\"></div></div>");
                }
                if (prio != "Normal")
                {
                    $("#priority option").each(function(){                    
                        $(cardRef+" .iconBar .prioBack .prioIcon").removeClass($(this).val());
                    });
                
                    $(cardRef+" .iconBar .prioBack .prioIcon").addClass(prio).attr({"title": prio + " Priority"});
                }
                else if (prio == "Normal")
                {
                    $(cardRef+" .iconBar .prioBack ").remove();
                }
                
                
                //This section handles the calendar icon
                if (dueDate != null && $(cardRef + " .iconBar .calBack").length == 0)
                {
                    $(cardRef+ " .iconBar").append("<div class=\"calBack\"><div class=\"calIcon\"></div></div>"); 
                }
                if (dueDate == null || dueDate == "")
                {
                    $(cardRef+ " .iconBar .calBack").remove(); 
                }
                var day = date.getDate();
                var month = date.getMonth(); 
                var year = date.getFullYear();
                var until = daysUntil(year, month, day);
                $(cardRef+ " .iconBar .calBack .calIcon").html(day).attr({"title": "Due: "+ dueDate + " ("+until+" days from today)"});
                if (until <= 7)
                {
                    $(cardRef+ " .iconBar .calBack .calIcon").addClass("calIconWeek");
                }
                else
                {
                    $(cardRef+ " .iconBar .calBack .calIcon").removeClass("calIconWeek");    
                }
                if (until == 0)
                {
                    $(cardRef+ " .iconBar .calBack .calIcon").attr({"title": "Due: "+ dueDate + " (Today)"});
                }
                
                
                //This section handles the size icon
                if (size != null && $(cardRef + " .iconBar .sizeBack").length ==0)
                {
                    $(cardRef+ " .iconBar").append("<div class=\"sizeBack\"><div class=\"sizeIcon\"></div></div>"); 
                }
                if (size == null || size == 0 || size == "")
                {
                    $(cardRef+ " .iconBar .sizeBack").remove();
                }
                $(cardRef+ " .iconBar .sizeBack .sizeIcon").html(size).attr({"title": "Size: "+ size});
                
            }
            /*</editor-fold>*/  
            
            
            function daysUntil(year, month, day) {
                var now = new Date(),
                dateEnd = new Date(year, month, day), // months are zero-based
                days = (dateEnd - now) / 1000/60/60/24;   // convert milliseconds to days

                return Math.round(days);
            }

            function dialogDisplay(job){
                $("#jobtype option").each(function(){
                    $("#Details").removeClass($(this).val());
                });
                if (job == null)
                {
                    $("#Details").addClass("Task");
                }
                else
                {
                    $("#Details").addClass(job);
                }
            }
            
            //Card creation function, adds the card to the page. Need the following Bugzilla parameters: product, component, version, Jobtype, priority. 
            //Note: Id has been added for testing purposes
            function  createCard(/**TEST ONLY**/ id,col, component,   priority, product, severity, summary, version, user, dueDate, size, description, status){ 
                   
                /*$.ajax({
                    url: "ajax_create_bug.php",
                    type: "POST",
                    data: {    
                        /*"whichColumn": col
                        "component": component,
                        "priority": priority,
                        "product": product,
                        "severity": severity,
                        "summary": summary,
                        "version": version
                        /*"component": component,
                    },
                    dataType: "json",
                    success: function(data, status){
                
                        if (data.error)
                        {
                            alert(data.error.message);
                        }
                        else if (!data.result)
                        {
                            alert("Something is wrong");
                        }
                        else 
                        {
                            //Card creation logic will be placed here as soon as the Bug.create/Bug.update issues have been resolved
                        }
                        
                    },
                    error: function(jqXHR, textStatus, errorThrown){
                        alert("There was an error:" + textStatus);
                    }
                });*/
                //TODO All of the follwing creation code needs to be moved up into the final else: Only want to append a new card if one is successfully stored on Bugzilla
                
                //The Bugzilla Documentation said that the create method will only return the new ID upon completion
                //var id = data.result.id[0];
                           
                var newCard = $('<div id="'+id+'" class="card "><div class="cardText">'+summary+'</div><div class="iconBar"></div></div>');
                    
                newCard.addClass("cmVoice {cMenu:\'contextMenuCard\'}, Task");
                //<div class="cardText">Existing Card</div><div class="iconBar"></div></div>   
                var newLi = $('<li></li>').append(newCard);
                                                                       
                $("#"+col.replace(/\s+/g, '')).append(newLi);
                    
                //TODO Move this into the success block of the AJAX call because we only want the local data to change if a new card i successfully created
                //NOTE: I realize saving the data locally and on the database violates the DRY principle however I don't want the user to have to wait for an AJAX call to complete in order to access bug info
                newCard.data({
                    "title": summary,
                    "jobtype": severity,
                    "priority": priority,
                    "product": product,
                    "component": component,
                    "version": version,
                    "user": user,
                    "whichColumn": col,
                    "dueDate": dueDate,
                    "size": size,
                    "description": description,
                    "status": status
                        
                });
                    
                $(document).buildContextualMenu(
                {
                    menuWidth:200,
                    overflow:2,
                    menuSelector: ".menuContainer",
                    iconPath:"ico/",
                    hasImages:false,
                    fadeInTime:200,
                    fadeOutTime:100,
                    adjustLeft:0,
                    adjustTop:0,
                    opacity:.99,
                    shadow:true,
                    onContextualMenu:function(o,e){}

                });
                
            }

            
            // TODO: Need to find a way to store the column info on the Bugzilla server. Make a new field? Use an existing one that is otherwise rarely utilized? 
            function ajaxEditBug(col, component, id, priority, product, severity, summary, version, user, dueDate, size, description, status){
                $.ajax({
                    url: "ajax_modify_bug.php",
                    type: "POST",
                    data: { 
                        "bug_id": id,
                        "component": component,
                        "priority": priority,
                        "product": product,
                        "severity": severity,
                        "summary": summary,
                        "version": version,
                        "status": status
                    },
                    dataType: "json",
                    success: function(data){
                
                        if (data.error)
                        {
                            alert(data.error.message);
                        }
                        else if (!data.result)
                        {
                            alert("Something is wrong");
                        }
                        else 
                        {
                            //Will eventually hold the card.data map below. Need to make the Bug.Update work first
                        }
                        
                    },
                    error: function(jqXHR, textStatus, errorThrown){
                        alert("There was an error:" + textStatus);
                    }
                });
                
                //TODO Move this into the success block of the AJAX call because we only want the local data to change if the database data is changed
                //NOTE: I realize saving the data locally and on the database violates the DRY principle however I don't want the user to have to wait for an AJAx call to complete in order to access bug info
                $("#"+id).data({
                    "whichColumn": col,
                    "component": component,                   
                    "product": product,
                    "priority": priority,
                    "jobtype": severity,
                    "title": summary,
                    "version": version,
                    "user": user,
                    "dueDate": dueDate,
                    "size": size,
                    "description": description,
                    "status": status
                });
            }
            
            //An update function that stores a card position when called
            function updatePosition(column, cardId)
            {
                //Automatically updates the card's position both in local data and server data. Waiting on Bug.update Resolution
                
                /*
                 *
                 *$.ajax({
                 *  url: "ajax_modify_bug.php",
                 *  type: "POST",
                 *  data: { 
                 *       "bug_id": cardId
                 *      //TODO Need to add the below field to the Bugzilla field options
                 *      /*"whichColumn": column
                 *  },
                 *  dataType: "json",
                 *  success: function(data, status){
                 *
                 *      if (data.error)
                 *      {
                 *          alert(data.error.message);
                 *      }
                 *      else if (!data.result)
                 *      {
                 *          alert("Something is wrong");
                 *      }
                 *      else 
                 *      {
                 *          //Will eventually hold the card.data map below. Need to make the Bug.Update work first
                 *      }
                 *      
                 *  },
                 *  error: function(jqXHR, textStatus, errorThrown){
                 *      alert("There was an error:" + textStatus);
                 *  }
                 *   });
                 */
                
                $("#"+cardId).data({
                    "whichColumn": column
                });
                    
            }
               
            //A function that updates the whichColumn field of every card in a column
            /*TODO I feel like this is very inefficient, also need to figure out how to OVERLOAD!! */
            function updatePosition1(col)
            {
                $("#"+col+" .card").each(function(){
                    var cardId = $(this).attr("id");
                    updatePosition(col, cardId);
                });
            }
            
            function fileBug(component, priority, product, severity, summary, version){
               
            }
            /*$.ajax({
                url: "ajax_get_single_bug.php",
                type: "POST",
                data: { 
                   "bug_id": 4111
                   },
                dataType: "json",
                success: function(data, status){
                    //alert(data.result.bugs[0].summary);
                    var bug = data.result.bugs[0];
                    createCard("Done", bug.summary);
                }
            });*/
            
            /*$.ajax({
                url: "ajax_modify_bug.php",
                type: "POST",
                data: { 
                    "bug_id": 4111,
                    "summary": "This is a new summary"
                },
                dataType: "json",
                success: function(data, status){
                
                    if (data.error)
                    {
                        alert(data.error.message);
                    }
                    else if (!data.result)
                    {
                        alert("Something is wrong");
                    }
                    else 
                    {
                        alert("We're in");
                        var bug = data.result.bugs[0];
                    }
                },
                error: function(jqXHR, textStatus, errorThrown){
                    alert("There was an error:" + textStatus);
                }
            });*/
            
        </script>
    </head>
    <body>

        <div id="dialogInvalid" class="ui-dialog-content ui-widget-content"  title="Invalid Input" >
            <p>Must Specify the Card's Title!!!</p>
        </div>

        <div id="dialogAddEditCard" class="ui-dialog-content ui-widget-content"  title="Edit" >

            <div id="edit-tabs" class="ui-tabs ui-widget ui-widget-content ui-corner-all">
                <ul>
                    <li><a href="#Details">Details</a></li>
                    <li><a href="#Comments">Comments</a></li>
                    <li><a href="#Attachments">Attachments</a></li>
                </ul>
                <div id="Details">
                    <form>
                        <fieldset>
                            <div style="float:top; max-height: 80px;">
                                <label for="title">Title:</label>
                                <textarea  name="title" id="title" class="text ui-widget-content ui-corner-all" style="width:960px; height: 40px; max-height: 60px;"  ></textarea>
                            </div>
                            <div style="float: left;">
                                <label for="product">Product:</label>
                                <select  name="product" id="product"  class="text ui-widget-content ui-corner-all" ></select>
                                <label for="component">Component:</label>
                                <select  name="component" id="component"  class="text ui-widget-content ui-corner-all" ></select>
                                <div style="float: top">
                                    <div style="float: left;">
                                        <label for="version">version</label>
                                        <select  name="version" id="version"  class=" text ui-widget-content ui-corner-all, half">    </select>
                                    </div>
                                    <div style="float: left; margin-left: 10px;">
                                        <label for="jobtype">Job Type:</label>
                                        <select  name="jobtype" id="jobtype"  class=" text ui-widget-content ui-corner-all, half" ></select>
                                    </div>
                                </div>
                                <div style="float: top">
                                    <div style="float: left;">
                                        <label for="bug_status">Status:</label>
                                        <select  name="bug_status" id="bug_status"  class="text ui-widget-content ui-corner-all, half" ></select>
                                    </div>
                                    <div style="float: left; margin-left: 10px;">
                                        <label for="user">Assigned User:</label>
                                        <select  name="user" id="user"  class="text ui-widget-content ui-corner-all, half" >   
                                            <option></option>
                                            <option>User 1</option>
                                            <option>User 2</option>
                                            <option>User 3</option>
                                            <option>User 4</option>
                                        </select>
                                    </div>
                                </div>
                                <div style="float: top">
                                    <div style="float: left;">
                                        <label for="priority">Priority:</label>
                                        <select  name="priority" id="priority"  class="text ui-widget-content ui-corner-all, half">    </select>

                                    </div>
                                    <div style="float: left; margin-left: 10px;">
                                        <label for="whichColumn">Into Column:</label>
                                        <select  name="whichColumn" id="whichColumn"  class="text ui-widget-content ui-corner-all, half" >     
                                            <option>To Do</option>
                                            <option>Doing</option>
                                            <option>Done</option> 
                                            <option>Backlog</option> 
                                            <option>Archive</option>                            
                                        </select>
                                    </div>
                                </div>
                                <div style="float: left;">
                                    <div style="float: left;">
                                        <label for="dueDate">Due Date:</label>
                                        <input type="text" name="dueDate" id="dueDate" class="Dates text ui-widget-content ui-corner-all" style="width:100px;"/>
                                    </div>
                                    <div style="float: left; margin-left: 10px;">
                                        <label for="size">Size:</label>
                                        <input type="number" name="size" id="size" class="text ui-widget-content ui-corner-all" style="width:100px;" min="1"/>
                                    </div>
                                </div>
                            </div>
                            <div style="float: left; margin-left: 10px; width: 50%; height: 680px;">
                                <span style="width: 75%;">
                                    <label for="description">Description:</label>
                                    <textarea  name="description" id="description" class="text ui-widget-content ui-corner-all" style="width:95%; height: 95%; max-height: 100%; max-width: 100%;"  ></textarea> 
                                </span>
                            </div>
                        </fieldset>
                    </form>
                </div>

                <div id="Comments">
                    <span>
                        <label for="comments">Comments</label>
                        <textarea  name="comments" id="comments"  class="text ui-widget-content ui-corner-all" style="width:95%; height: 95%; max-height: 100%; max-width: 100%;"  ></textarea>
                    </span>
                </div>
                <div id="Attachments">
                    <p>These are attachments</p>
                </div>
            </div>
        </div>   

        <ul class="tablists cmVoice {cMenu: 'contextMenuColumn'}" id="Backlog" > 
            <li class="bigBanners">Backlog</li>      
        </ul> 
        <ul class="tablists cmVoice {cMenu: 'contextMenuColumn'}" id="Archive">
            <li class="bigBanners">Archive</li>      
        </ul>    
        <ul class="tablists cmVoice {cMenu: 'contextMenuColumn'}" id="Limbo">
            <li class="bigBanners">Limbo</li>      
        </ul> 
        <div class="toolbar">                
            <button class="btnTab">Backlog</button>
            <button class="btnTab">Archive</button>
            <button class="btnTab">Limbo</button>
            <button id="btnAddCard">Add Card</button>
        </div>

        <ul id="ToDo" class="column cmVoice {cMenu: 'contextMenuColumn'}">
            <li class="banners">To Do</li>                        
        </ul>
        <ul id="Doing" class="column cmVoice {cMenu: 'contextMenuColumn'}">
            <li class="banners">Doing</li>
        </ul>
        <ul id="Done" class="column cmVoice {cMenu: 'contextMenuColumn'}">
            <li class="banners">Done</li>
        </ul>
        <div class="mbmenu" id="contextMenuCard">
            <a action="editView(0)">View Card Details</a>
            <a action="editView(1)">View Card Comments</a>
            <a action="editView(2)">View Card Attachments</a>
            <a rel="separator"> </a>
            <a class="{menu:'moveCardTo'}">Move Card to</a>
            <a class="{menu:'setPriority'}">Set Priority</a>
            <a rel="separator"> </a>
            <a action="deleteCard()">Delete Card</a>
        </div>
        <div id="moveCardTo" class="mbmenu">
        </div>
        <div id="moveAllCards" class="mbmenu">
        </div>
        <div id="setPriority" class="mbmenu">
        </div>
        <div class="mbmenu" id="contextMenuColumn">            
            <a class="{menu:'moveAllCards'}">Move All Cards to</a>
            <a rel="separator"> </a>
            <a action="addCardToCol()">Add Card</a>
        </div>
        <div>
            <table id="table1">

            </table>
        </div>
    </body>
</html>

